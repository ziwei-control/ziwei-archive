# 紫微智控 - 模型配置规范

## 模型总览

| 岗位 | 模型 ID | 提供商 | 类型 | 上下文 | Max Tokens |
|------|---------|--------|------|---------|------------|
| V-01 | `qwen-portal/vision-model` | Qwen Portal | 多模态 | 128K | 8192 |
| T-01 | `bailian/qwen3-max-2026-01-23` | 阿里百炼 | 文本 | 262K | 65536 |
| T-02 | `bailian/qwen3-coder-plus` | 阿里百炼 | 代码 | 1M | 65536 |
| T-03 | `bailian/qwen3-coder-next` | 阿里百炼 | 代码 | 262K | 65536 |
| T-04 | `bailian/qwen3.5-plus` | 阿里百炼 | 文本 | 1M | 65536 |
| T-05 | `bailian/glm-4.7` | 阿里百炼 | 文本 | 202K | 16384 |
| T-06 | `bailian/kimi-k2.5` | 阿里百炼 | 文本 | 262K | 32768 |
| T-07 | `qwen-portal/coder-model` | Qwen Portal | 代码/网络 | 128K | 8192 |

---

## OpenClaw 配置

### 配置文件位置
`/root/.openclaw/openclaw.json`

### Bailian 提供商配置
```json
{
  "models": {
    "providers": {
      "bailian": {
        "baseUrl": "https://coding.dashscope.aliyuncs.com/v1",
        "apiKey": "sk-sp-68f305abb87846f7a21b5ebb53530890",
        "api": "openai-completions",
        "models": [
          {
            "id": "qwen3-max-2026-01-23",
            "name": "Qwen3 Max (首席架构师 T-01)",
            "reasoning": false,
            "contextWindow": 262144,
            "maxTokens": 65536
          },
          {
            "id": "qwen3.5-plus",
            "name": "Qwen3.5 Plus (逻辑推理机 T-04)",
            "reasoning": false,
            "contextWindow": 1000000,
            "maxTokens": 65536
          },
          {
            "id": "qwen3-coder-next",
            "name": "Qwen3 Coder Next (代码审计员 T-03)",
            "reasoning": false,
            "contextWindow": 262144,
            "maxTokens": 65536
          },
          {
            "id": "qwen3-coder-plus",
            "name": "Qwen3 Coder Plus (代码特种兵 T-02)",
            "reasoning": false,
            "contextWindow": 1000000,
            "maxTokens": 65536
          },
          {
            "id": "glm-4.7",
            "name": "GLM4.7 (跨域翻译家 T-05)",
            "reasoning": false,
            "contextWindow": 202752,
            "maxTokens": 16384
          },
          {
            "id": "kimi-k2.5",
            "name": "Kimi2.5 (长文解析器 T-06)",
            "reasoning": false,
            "contextWindow": 262144,
            "maxTokens": 32768
          }
        ]
      }
    }
  }
}
```

### 模型别名配置
```json
{
  "agents": {
    "defaults": {
      "models": {
        "bailian/qwen3-max-2026-01-23": { "alias": "t1-architect" },
        "bailian/qwen3.5-plus": { "alias": "t4-logic" },
        "bailian/qwen3-coder-next": { "alias": "t3-auditor" },
        "bailian/qwen3-coder-plus": { "alias": "t2-coder" },
        "bailian/glm-4.7": { "alias": "t5-translator" },
        "bailian/kimi-k2.5": { "alias": "t6-reader" }
      }
    }
  }
}
```

---

## 模型调用规范

### 调用权限矩阵

| 调用方 | 可调用模型 | 审批要求 |
|--------|-----------|----------|
| T-01 首席架构师 | 所有模型 | 自主决策 |
| V-01 视觉侦察兵 | vision-model | T-01 审批 |
| T-02 代码特种兵 | coder-plus | T-01 委派 |
| T-03 代码审计员 | coder-next | 自主 |
| T-04 逻辑推理机 | qwen3.5-plus | T-01 委派 |
| T-05 跨域翻译家 | glm-4.7 | T-01 委派 |
| T-06 长文解析器 | kimi-k2.5 | T-01 委派 |
| T-07 网络爬虫 | coder-model | T-01 委派 |

### 调用流程
```
1. 请求方生成调用请求（含 Prompt、上下文、期望输出）
2. T-01 审批（如需）
3. 脚本调用 API
4. 记录调用日志（时间、模型、tokens、成本）
5. 返回结果给请求方
```

### 调用日志格式
```markdown
## API 调用日志
- **时间**: [ISO8601]
- **调用方**: [岗位]
- **模型**: [模型 ID]
- **输入 Tokens**: [数量]
- **输出 Tokens**: [数量]
- **成本**: [金额]
- **状态**: [成功/失败]
- **错误信息**: [如有]
```

---

## 额度管理

### V-01 视觉侦察兵限额
- **限制**: 每 48 小时最多 4 次
- **追踪文件**: `data/logs/vision_usage.log`
- **预警阈值**: 剩余额度 < 2 次时邮件康纳

### 追踪日志格式
```
[时间戳] [任务 ID] [调用原因] [剩余次数/48h]
```

### 额度重置
- **重置时间**: 每 48 小时从首次调用开始计算
- **通知**: 重置后邮件通知康纳

---

## 成本估算

### 模型价格参考（以阿里百炼官方为准）

| 模型 | 输入价格 | 输出价格 | 备注 |
|------|---------|---------|------|
| qwen3-max | ¥0.04/K | ¥0.12/K | 高端模型 |
| qwen3.5-plus | ¥0.02/K | ¥0.06/K | 性价比 |
| qwen3-coder-plus | ¥0.04/K | ¥0.12/K | 代码专用 |
| qwen3-coder-next | ¥0.02/K | ¥0.06/K | 代码审计 |
| glm-4.7 | ¥0.01/K | ¥0.03/K | 经济型 |
| kimi-k2.5 | ¥0.02/K | ¥0.06/K | 长文本 |

### 成本监控
- **日报**: 通信官每日汇总成本邮件康纳
- **预警**: 单日成本>¥50 时触发预警
- **熔断**: 单日成本>¥100 时暂停非关键任务

---

## 模型切换指令

### 当前默认模型
`qwen-portal/coder-model`（当前对话使用）

### 切换命令（等待 Martin 指令）
```
切换到 t1-architect  → bailian/qwen3-max-2026-01-23
切换到 t2-coder      → bailian/qwen3-coder-plus
切换到 t3-auditor    → bailian/qwen3-coder-next
切换到 t4-logic      → bailian/qwen3.5-plus
切换到 t5-translator → bailian/glm-4.7
切换到 t6-reader     → bailian/kimi-k2.5
切换到 qwen          → qwen-portal/coder-model（默认）
```

### 切换流程
1. Martin 发出切换指令
2. 确认目标模型
3. 更新 OpenClaw 配置（或会话级覆盖）
4. 记录切换日志
5. 邮件通知康纳（可选）

---

## 故障处理

### 模型调用失败
| 错误码 | 含义 | 处理方式 |
|--------|------|----------|
| 400 | 请求格式错误 | 检查 Prompt 格式 |
| 401 | API Key 无效 | 检查配置，联系 Martin |
| 429 | 限流 | 等待后重试，记录日志 |
| 500 | 服务端错误 | 切换备用模型 |
| 503 | 服务不可用 | 切换备用模型，邮件警报 |

### 备用模型策略
| 主模型 | 备用模型 |
|--------|---------|
| qwen3-max | qwen3.5-plus |
| qwen3-coder-plus | qwen3-coder-next |
| glm-4.7 | qwen3.5-plus |
| kimi-k2.5 | qwen3.5-plus |

---

## API Key 安全

### 存储位置
- **OpenClaw 配置**: `/root/.openclaw/openclaw.json`
- **环境变量**: `~/.ziwei/secret`（脚本读取）

### 安全规范
1. **严禁明文暴露**: 代码中不得硬编码 API Key
2. **权限控制**: 仅 T-01 有权读取完整配置
3. **审计日志**: 所有 API Key 使用记录留痕
4. **泄露应急**: 发现泄露立即邮件康纳更换

---

**版本**: 1.0  
**最后更新**: 2025-02-27  
**状态**: 生效中
