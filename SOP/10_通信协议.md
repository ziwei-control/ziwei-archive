# 紫微智控 - 岗位间通信协议

## 协议概述

**核心原则**: 全员交互留痕，禁止"静默式"调用

| 项目 | 规格 |
|------|------|
| **通信形式** | Markdown 日志文件 |
| **存储位置** | `docs/comm_logs/[日期]/` |
| **双向链接** | Obsidian 自动建立关联 |
| **通信类型** | 指令下达/数据移交/状态汇报/请求协助/风险预警 |

---

## 通信日志格式

### 标准格式

**文件命名**: `[发送者]_to_[接收者]_[时间戳].md`

```markdown
---
发送者：[岗位代号 - 名称]
接收者：[岗位代号 - 名称]
类型：[指令下达/数据移交/状态汇报/请求协助/风险预警]
时间：[ISO8601 时间戳]
关联任务：[任务 ID]
优先级：[高/中/低]
---

## 沟通内容
[详细说明沟通目的、背景、要求]

## 附件/引用
- [相关文件链接]
- [数据文件路径]

## 期望响应
[希望接收方做什么，何时完成]

## 状态
[ ] 等待响应
[ ] 已读
[✓] 已完成
```

---

## 通信类型详解

### 1. 指令下达

**发送方**: 上级岗位（如 T-01 首席架构师）  
**接收方**: 下级岗位（如 T-02 代码特种兵）

**示例**:

```markdown
---
发送者：T-01 首席架构师
接收者：T-02 代码特种兵
类型：指令下达
时间：2025-02-27T14:05:00+08:00
关联任务：TASK-20250227-001
优先级：高
---

## 沟通内容

请根据以下需求生成电商网站登录页面代码：

### 需求说明
1. 响应式设计，兼容移动端
2. 包含用户名、密码输入框
3. 包含"记住我"复选框
4. 包含"忘记密码"链接
5. 使用 React + Tailwind CSS

### 参考设计
视觉侦察兵已提供设计描述，见附件。

## 附件/引用
- ![[V-01_to_T-01_20250227T1400_视觉分析报告.md]]
- docs/tasks/TASK-20250227-001_requirements.md

## 期望响应
请在 1 小时内完成代码生成，并提交 T-03 审计。

## 状态
[ ] 等待响应
```

### 2. 数据移交

**发送方**: 完成本阶段工作的岗位  
**接收方**: 下一阶段岗位

**示例**:

```markdown
---
发送者：V-01 视觉侦察兵
接收者：T-01 首席架构师
类型：数据移交
时间：2025-02-27T14:00:00+08:00
关联任务：TASK-20250227-001
优先级：中
---

## 沟通内容

已完成用户上传的 APP 界面草图解析，现将分析结果移交给您。

### 图像描述
- **图像类型**: UI 设计图（电商 APP 首页）
- **主要元素**:
  - 顶部导航栏（包含搜索框）
  - 轮播图区域
  - 商品分类网格
  - 底部标签栏
- **用户意图**: 创建一个电商 APP 首页

### 前端描述
建议使用 React Native 开发，布局采用 Flexbox。

## 附件/引用
- 原始图片：docs/tasks/TASK-20250227-001_input.png
- 分析详情：docs/analysis/V-01_analysis_20250227.md

## 期望响应
请确认任务优先级，并指派开发岗位。

## 状态
[✓] 已完成
```

### 3. 状态汇报

**发送方**: 执行中岗位  
**接收方**: 协调岗位（T-01）

**示例**:

```markdown
---
发送者：T-02 代码特种兵
接收者：T-01 首席架构师
类型：状态汇报
时间：2025-02-27T14:30:00+08:00
关联任务：TASK-20250227-001
优先级：低
---

## 沟通内容

汇报当前任务进度：

### 完成情况
- [x] HTML 结构搭建
- [x] CSS 样式编写
- [x] 响应式适配
- [ ] JavaScript 交互（进行中，50%）

### 遇到问题
无

### 预计完成
30 分钟内完成全部代码。

## 附件/引用
- 当前代码：docs/tasks/TASK-20250227-001_code/

## 期望响应
无需响应，仅知会。

## 状态
[✓] 已完成
```

### 4. 请求协助

**发送方**: 遇到困难岗位  
**接收方**: 相关专业岗位

**示例**:

```markdown
---
发送者：T-02 代码特种兵
接收者：T-04 逻辑推理机
类型：请求协助
时间：2025-02-27T15:00:00+08:00
关联任务：TASK-20250227-001
优先级：高
---

## 沟通内容

在实现购物车逻辑时遇到复杂的状态管理问题，请求协助分析。

### 问题描述
需要实现以下功能：
1. 添加商品到购物车
2. 更新商品数量
3. 删除商品
4. 计算总价（含优惠券）

当前状态管理逻辑混乱，容易出现状态不一致。

### 已尝试方案
- 使用 useState 管理状态 → 状态同步困难
- 使用 Context → 性能问题

## 附件/引用
- 当前代码：docs/tasks/TASK-20250227-001_code/cart.js

## 期望响应
请分析最优状态管理方案，2 小时内回复。

## 状态
[ ] 等待响应
```

### 5. 风险预警

**发送方**: 任何岗位  
**接收方**: T-01 首席架构师 + 相关岗位

**示例**:

```markdown
---
发送者：T-03 代码审计员
接收者：T-01 首席架构师
类型：风险预警
时间：2025-02-27T15:30:00+08:00
关联任务：TASK-20250227-001
优先级：高
---

## 沟通内容

⚠️ **发现严重安全风险**

### 风险描述
T-02 提交的代码中存在 SQL 注入漏洞：

```javascript
// 危险代码
const query = `SELECT * FROM users WHERE username = '${username}'`;
```

### 风险等级
**高危** - 可能导致数据库被恶意查询

### 影响范围
- 用户登录模块
- 用户注册模块

## 附件/引用
- 审计报告：docs/logs/auditor_report_TASK-20250227-001.md

## 期望响应
请立即要求 T-02 修复，使用参数化查询。

## 状态
[ ] 等待响应
```

---

## 通信日志存储

### 目录结构

```
docs/comm_logs/
├── 2025-02-27/
│   ├── V-01_to_T-01_20250227T1400.md
│   ├── T-01_to_T-02_20250227T1405.md
│   ├── T-02_to_T-03_20250227T1450.md
│   └── T-03_to_Conner_20250227T1500.md
├── 2025-02-28/
└── ...
```

### 归档策略

| 类型 | 保留期限 | 说明 |
|------|---------|------|
| **指令下达** | 永久 | 重要决策记录 |
| **数据移交** | 永久 | 任务流转凭证 |
| **状态汇报** | 90 天 | 过程记录 |
| **请求协助** | 永久 | 技术决策参考 |
| **风险预警** | 永久 | 风险案例库 |

---

## Obsidian 集成

### 双向链接

所有通信日志通过 Obsidian 双向链接自动关联：

```markdown
## 关联日志

### 上游指令
- ![[T-01_to_T-02_20250227T1405.md]]

### 下游移交
- ![[T-02_to_T-03_20250227T1450.md]]

### 相关沟通
- ![[T-02_to_T-04_20250227T1500_请求协助.md]]
```

### 图谱视图

在 Obsidian 图谱中可直观查看：
- 任务流转路径
- 岗位协作关系
- 沟通频率热力图

### Dataview 查询

```markdown
## 今日沟通统计
```dataview
TABLE type, count(rows) as 次数
FROM "docs/comm_logs/2025-02-27"
GROUP BY type
```
```

---

## 通信协议与邮件系统

### 内部通信 vs 外部邮件

| 维度 | 内部通信日志 | 外部邮件 |
|------|------------|---------|
| **对象** | 岗位之间 | 康纳/Martin |
| **形式** | Markdown 文件 | 电子邮件 |
| **频率** | 实时 | 按机制（4 小时/即时） |
| **内容** | 详细技术细节 | 摘要汇报 |
| **存储** | docs/comm_logs/ | 邮件服务器 |

### 邮件生成流程

```
内部通信日志积累
    ↓
通信官扫描日志
    ↓
整合为简报（巡查/审计/学习）
    ↓
生成邮件发送给康纳
    ↓
记录邮件发送日志
```

---

## 通信质量规范

### 5C 原则

| 原则 | 说明 | 示例 |
|------|------|------|
| **Clear (清晰)** | 表达明确，无歧义 | "请在 1 小时内完成"而非"尽快" |
| **Concise (简洁)** | 简明扼要，不啰嗦 | 用列表而非长段落 |
| **Complete (完整)** | 信息完整，不遗漏 | 包含背景、要求、截止时间 |
| **Concrete (具体)** | 具体可执行，不抽象 | "使用 useState"而非"优化状态管理" |
| **Courteous (礼貌)** | 语气礼貌，尊重对方 | "请"、"谢谢" |

### 禁止行为

- ❌ 静默调用（不生成日志）
- ❌ 越权指挥（非上级发指令）
- ❌ 信息不全（缺少关键上下文）
- ❌ 模糊表达（"尽快"、"可能"）
- ❌ 情绪化语言（抱怨、指责）

---

## 通信审计

### 审计内容

审计长定期检查通信日志质量：

| 检查项 | 标准 |
|--------|------|
| **完整性** | 所有岗位间交互都有日志 |
| **及时性** | 交互后 5 分钟内生成日志 |
| **规范性** | 符合 5C 原则 |
| **关联性** | 双向链接正确建立 |

### 审计报告

**文件**: `docs/logs/comm_audit_[日期].md`

```markdown
# 通信质量审计报告

## 审计周期
2025-02-27 00:00 - 23:59

## 统计
- 总通信数：45 条
- 规范率：98%
- 问题数：1 条

## 问题记录
1. T-02_to_T-03_20250227T1450.md - 缺少期望响应字段

## 改进建议
- 加强日志模板培训
- 增加自动校验脚本
```

---

**版本**: 1.0  
**最后更新**: 2025-02-27  
**状态**: 生效中
