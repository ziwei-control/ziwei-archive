# ç´«å¾®æ™ºæ§ Â· è‡ªåŠ¨åŒæ­¥åŠŸèƒ½è¯´æ˜

> æ¯ 30 åˆ†é’Ÿå·¡æŸ¥ + æ¯æ—¥ 23:40 å¼ºåˆ¶åŒæ­¥

---

## âœ… åŠŸèƒ½æ¦‚è¿°

| åŠŸèƒ½ | é¢‘ç‡ | è¯´æ˜ |
|------|------|------|
| **è‡ªåŠ¨å·¡æŸ¥** | æ¯ 30 åˆ†é’Ÿ | æ£€æŸ¥æ–‡ä»¶æ›´æ”¹ï¼Œè‡ªåŠ¨åŒæ­¥ |
| **æ¯æ—¥å¼ºåˆ¶åŒæ­¥** | æ¯æ—¥ 23:40 | æ— è®ºæœ‰æ— æ›´æ”¹éƒ½åŒæ­¥ |
| **åŒå¹³å°æ¨é€** | è‡ªåŠ¨ | GitHub + Gitee åŒæ—¶æ¨é€ |

---

## ğŸ¯ å·¥ä½œåŸç†

### è‡ªåŠ¨å·¡æŸ¥æµç¨‹

```
æ¯ 30 åˆ†é’Ÿ
    â†“
æ£€æŸ¥ Git çŠ¶æ€
    â†“
å‘ç°æ›´æ”¹ï¼Ÿ
    â”œâ”€ æ˜¯ â†’ è¿è¡ŒåŒæ­¥è„šæœ¬ â†’ æ¨é€ GitHub + Gitee
    â””â”€ å¦ â†’ è·³è¿‡åŒæ­¥
    â†“
è®°å½•æ—¥å¿—
    â†“
ç­‰å¾…ä¸‹æ¬¡å·¡æŸ¥
```

### æ¯æ—¥å¼ºåˆ¶åŒæ­¥

```
æ¯æ—¥ 23:40
    â†“
è¿è¡ŒåŒæ­¥è„šæœ¬
    â†“
æ¨é€ GitHub + Gitee
    â†“
è®°å½•åŒæ­¥æŠ¥å‘Š
```

---

## ğŸ“‹ é…ç½®æ–‡ä»¶

### Cron å®šæ—¶ä»»åŠ¡

**ä½ç½®**: `/etc/cron.d/ziwei-sync`

**å†…å®¹**:
```bash
# æ¯ 30 åˆ†é’Ÿå·¡æŸ¥ä¸€æ¬¡ï¼ˆå‘ç°æ›´æ”¹è‡ªåŠ¨åŒæ­¥ï¼‰
*/30 * * * * root cd /home/admin/Ziwei && /usr/bin/python3 /home/admin/Ziwei/scripts/auto-sync-watchdog.py >> /home/admin/Ziwei/data/logs/cron_watchdog.log 2>&1

# æ¯æ—¥ 23:40 å¼ºåˆ¶åŒæ­¥
40 23 * * * root cd /home/admin/Ziwei && /usr/bin/bash /home/admin/Ziwei/scripts/sync-to-both.sh >> /home/admin/Ziwei/data/logs/cron_daily_sync.log 2>&1
```

### å·¡æŸ¥è„šæœ¬

**ä½ç½®**: `/home/admin/Ziwei/scripts/auto-sync-watchdog.py`

**åŠŸèƒ½**:
- æ£€æŸ¥ Git çŠ¶æ€
- æ£€æŸ¥æ–‡ä»¶å“ˆå¸Œ
- å‘ç°æ›´æ”¹è‡ªåŠ¨åŒæ­¥
- è®°å½•è¯¦ç»†æ—¥å¿—

---

## ğŸ”§ ç®¡ç†å‘½ä»¤

### æŸ¥çœ‹çŠ¶æ€

```bash
# æŸ¥çœ‹ Cron æœåŠ¡çŠ¶æ€
systemctl status crond

# æŸ¥çœ‹ Cron é…ç½®
cat /etc/cron.d/ziwei-sync
```

### æŸ¥çœ‹æ—¥å¿—

```bash
# å·¡æŸ¥æ—¥å¿—ï¼ˆå®æ—¶ï¼‰
tail -f /home/admin/Ziwei/data/logs/cron_watchdog.log

# æ¯æ—¥åŒæ­¥æ—¥å¿—ï¼ˆå®æ—¶ï¼‰
tail -f /home/admin/Ziwei/data/logs/cron_daily_sync.log

# æœ€æ–°åŒæ­¥æŠ¥å‘Š
ls -lt /home/admin/Ziwei/data/logs/sync_report_*.md | head -1 | awk '{print $NF}' | xargs cat
```

### é‡å¯æœåŠ¡

```bash
# é‡å¯ Cron
sudo systemctl restart crond

# æŸ¥çœ‹ Cron æ—¥å¿—
sudo journalctl -u crond -f
```

### ç¦ç”¨åŠŸèƒ½

```bash
# åˆ é™¤ Cron é…ç½®
sudo rm /etc/cron.d/ziwei-sync

# é‡å¯ Cron
sudo systemctl restart crond
```

---

## ğŸ“Š æ—¥å¿—ç¤ºä¾‹

### å·¡æŸ¥æ—¥å¿—

```
[2025-02-27T16:30:00] [INFO] ============================================================
[2025-02-27T16:30:00] [INFO] ç´«å¾®æ™ºæ§ - è‡ªåŠ¨å·¡æŸ¥åŒæ­¥å¯åŠ¨
[2025-02-27T16:30:00] [INFO] å·¡æŸ¥é—´éš”ï¼š30 åˆ†é’Ÿ
[2025-02-27T16:30:00] [INFO] æ¯æ—¥åŒæ­¥ï¼š23:40
[2025-02-27T16:30:00] [INFO] ============================================================
[2025-02-27T16:30:00] [INFO] ç¬¬ 1 æ¬¡å·¡æŸ¥
[2025-02-27T16:30:00] [INFO] æ£€æŸ¥æ–‡ä»¶æ›´æ”¹...
[2025-02-27T16:30:01] [WARN] å‘ç° Git æ›´æ”¹:
 M scripts/auto-sync-watchdog.py
?? docs/è‡ªåŠ¨åŒæ­¥åŠŸèƒ½è¯´æ˜.md
[2025-02-27T16:30:01] [WARN] å‘ç°æ›´æ”¹ï¼Œè§¦å‘è‡ªåŠ¨åŒæ­¥
[2025-02-27T16:30:01] [INFO] å¼€å§‹åŒæ­¥ï¼ˆåŸå› ï¼šè‡ªåŠ¨æ£€æµ‹æ›´æ”¹ï¼‰...
[2025-02-27T16:30:15] [SUCCESS] åŒæ­¥æˆåŠŸ
[2025-02-27T16:30:15] [INFO] ä¸‹æ¬¡å·¡æŸ¥ï¼š30 åˆ†é’Ÿå
```

### æ¯æ—¥åŒæ­¥æ—¥å¿—

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘          ç´«å¾®æ™ºæ§ - åŒå¹³å°åŒæ­¥ (GitHub + Gitee)         â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

[1/5] åŠ è½½é…ç½®...
  âœ“ GitHub é…ç½®ï¼šå·²åŠ è½½
  âœ“ Gitee é…ç½®ï¼šå·²åŠ è½½

[2/5] æ£€æŸ¥ Git çŠ¶æ€...
  âœ“ æ²¡æœ‰æœªæäº¤çš„æ›´æ”¹

[3/5] æ¨é€åˆ° GitHub...
  âœ“ GitHub æ¨é€æˆåŠŸ

[4/5] æ¨é€åˆ° Gitee...
  âœ“ Gitee æ¨é€æˆåŠŸ

[5/5] ç”ŸæˆåŒæ­¥æŠ¥å‘Š...
  âœ“ åŒæ­¥æŠ¥å‘Šå·²ä¿å­˜

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘              âœ… åŒå¹³å°åŒæ­¥å®Œæˆï¼                       â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

---

## ğŸ“ åŒæ­¥æŠ¥å‘Š

æ¯æ¬¡åŒæ­¥è‡ªåŠ¨ç”ŸæˆæŠ¥å‘Šï¼š

**ä½ç½®**: `data/logs/sync_report_YYYYMMDD_HHMMSS.md`

**å†…å®¹**:
```markdown
# ç´«å¾®æ™ºæ§åŒæ­¥æŠ¥å‘Š

**æ—¶é—´**: 2025-02-27 16:30:00

## æ¨é€ç»“æœ

| å¹³å° | çŠ¶æ€ | åœ°å€ |
|------|------|------|
| GitHub | âœ… æˆåŠŸ | https://github.com/ziwei-control/ziwei-archive |
| Gitee | âœ… æˆåŠŸ | https://gitee.com/ziwei-control/ziwei-archive |

## æäº¤ç»Ÿè®¡

**æäº¤æ•°**: 10
**æœ€åæäº¤**: è‡ªåŠ¨æäº¤ï¼š2025-02-27 16:30:00
**æ–‡ä»¶å¤§å°**: 600K
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. Gitee Token é…ç½®

å¿…é¡»å…ˆé…ç½® Gitee Tokenï¼Œå¦åˆ™åªæ¨é€åˆ° GitHubï¼š

```bash
nano /home/admin/Ziwei/.env
```

å¡«å†™ï¼š
```bash
GITEE_TOKEN="ä½ çš„çœŸå® Token"
```

### 2. æ–‡ä»¶æƒé™

ç¡®ä¿è„šæœ¬æœ‰æ‰§è¡Œæƒé™ï¼š

```bash
chmod +x /home/admin/Ziwei/scripts/auto-sync-watchdog.py
chmod +x /home/admin/Ziwei/scripts/sync-to-both.sh
```

### 3. Cron æƒé™

Cron é…ç½®éœ€è¦ root æƒé™ï¼š

```bash
sudo bash /home/admin/Ziwei/scripts/setup-cron.sh
```

### 4. æ—¥å¿—è½®è½¬

æ—¥å¿—æ–‡ä»¶ä¼šæŒç»­å¢é•¿ï¼Œå»ºè®®å®šæœŸæ¸…ç†ï¼š

```bash
# æ¸…ç† 30 å¤©å‰çš„æ—¥å¿—
find /home/admin/Ziwei/data/logs/ -name "*.log" -mtime +30 -delete
```

---

## ğŸ” æ•…éšœæ’æŸ¥

### é—®é¢˜ 1: å·¡æŸ¥ä¸æ‰§è¡Œ

**æ£€æŸ¥**:
```bash
# æŸ¥çœ‹ Cron çŠ¶æ€
systemctl status crond

# æŸ¥çœ‹ Cron æ—¥å¿—
sudo journalctl -u crond -f

# æ£€æŸ¥ Cron é…ç½®
cat /etc/cron.d/ziwei-sync
```

**è§£å†³**:
```bash
# é‡å¯ Cron
sudo systemctl restart crond
```

### é—®é¢˜ 2: åŒæ­¥å¤±è´¥

**æ£€æŸ¥**:
```bash
# æŸ¥çœ‹å·¡æŸ¥æ—¥å¿—
tail -100 /home/admin/Ziwei/data/logs/cron_watchdog.log

# æŸ¥çœ‹åŒæ­¥æŠ¥å‘Š
ls -lt /home/admin/Ziwei/data/logs/sync_report_*.md | head -1 | awk '{print $NF}' | xargs cat
```

**å¸¸è§åŸå› **:
- Gitee Token æœªé…ç½®æˆ–è¿‡æœŸ
- ç½‘ç»œè¿æ¥é—®é¢˜
- Git ä»“åº“æƒé™é—®é¢˜

**è§£å†³**:
```bash
# æ‰‹åŠ¨æµ‹è¯•åŒæ­¥
cd /home/admin/Ziwei
bash scripts/sync-to-both.sh
```

### é—®é¢˜ 3: æ–‡ä»¶æœªæ£€æµ‹

**æ£€æŸ¥**:
```bash
# æŸ¥çœ‹ Git çŠ¶æ€
git status

# æŸ¥çœ‹å·¡æŸ¥è„šæœ¬
cat /home/admin/Ziwei/scripts/auto-sync-watchdog.py
```

**è§£å†³**:
- ç¡®ä¿æ–‡ä»¶åœ¨ Git è·Ÿè¸ªä¸­
- æ£€æŸ¥æ–‡ä»¶å“ˆå¸Œæ£€æµ‹é€»è¾‘

---

## ğŸ“‹ é…ç½®æ£€æŸ¥æ¸…å•

- [ ] Cron æœåŠ¡å·²å®‰è£…
- [ ] Cron æœåŠ¡è¿è¡Œä¸­
- [ ] Cron é…ç½®æ–‡ä»¶å·²åˆ›å»º
- [ ] å·¡æŸ¥è„šæœ¬æœ‰æ‰§è¡Œæƒé™
- [ ] åŒæ­¥è„šæœ¬æœ‰æ‰§è¡Œæƒé™
- [ ] GitHub Token å·²é…ç½®
- [ ] Gitee Token å·²é…ç½®
- [ ] æ—¥å¿—ç›®å½•å­˜åœ¨
- [ ] æ‰‹åŠ¨æµ‹è¯•åŒæ­¥æˆåŠŸ

---

## ğŸ¯ æœ€ä½³å®è·µ

### 1. å®šæœŸæ£€æŸ¥æ—¥å¿—

```bash
# æ¯å¤©æŸ¥çœ‹ä¸€æ¬¡
tail -50 /home/admin/Ziwei/data/logs/cron_watchdog.log
```

### 2. æ¯å‘¨æ£€æŸ¥åŒæ­¥æŠ¥å‘Š

```bash
# æŸ¥çœ‹æœ¬å‘¨æŠ¥å‘Š
find /home/admin/Ziwei/data/logs/ -name "sync_report_*.md" -mtime -7 | xargs cat
```

### 3. æ¯æœˆæ¸…ç†æ—¥å¿—

```bash
# æ¸…ç†æ—§æ—¥å¿—
find /home/admin/Ziwei/data/logs/ -name "*.log" -mtime +30 -delete
```

### 4. ç›‘æ§ç£ç›˜ç©ºé—´

```bash
# æ£€æŸ¥ç£ç›˜ä½¿ç”¨
df -h /home/admin/Ziwei
```

---

## ğŸ”— ç›¸å…³æ–‡æ¡£

- [[åŒå¹³å°åŒæ­¥è¯´æ˜]] - åŒæ­¥åŠŸèƒ½è¯¦è§£
- [[Gitee é…ç½®æŒ‡å—]] - Gitee Token è·å–
- [[å·¥ä½œæµç¨‹å›¾]] - ç´«å¾®æ™ºæ§å·¥ä½œæµç¨‹

---

**é…ç½®å®Œæˆåï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨æ¯ 30 åˆ†é’Ÿå·¡æŸ¥å¹¶åŒæ­¥ï¼** ğŸš€
