# 紫微智控 · 一键启动任务指南

> 一个命令，自动完成所有步骤！

---

## 🎯 功能说明

运行一个命令，自动完成：
1. ✅ 创建项目（GitHub + Gitee）
2. ✅ 克隆到本地
3. ✅ 创建任务文件
4. ✅ 提交并推送到双平台
5. ✅ 启动紫微智控处理流程
6. ✅ 每步按部就班自动执行

---

## 📋 使用方法

### 基本用法

**无需切换目录，在任何位置都能执行！**

```bash
# 方式 1: 交互式输入（推荐）
bash scripts/run-task.sh

# 方式 2: 命令行参数（快速模式）
bash scripts/run-task.sh <任务 ID> "任务名称" "任务描述"
```

### 交互式输入示例

```bash
# 运行脚本
bash scripts/run-task.sh

# 屏幕提示：
╔════════════════════════════════════════════════════════╗
║          紫微智控 - 一键启动任务                       ║
╚════════════════════════════════════════════════════════╝

[1/3] 请输入任务 ID:
  格式：TASK-日期 - 序号（例如：TASK-20250227-001）
  任务 ID: TASK-20250227-001

[2/3] 请输入任务名称:
  例如：计算器项目、电商网站、数据分析脚本
  任务名称：Python 计算器

[3/3] 请输入任务描述:
  详细描述任务需求（可选，直接回车跳过）
  任务描述：创建一个命令行计算器

# 确认后自动执行所有步骤
```

### 命令行参数示例

#### 示例 1: 创建计算器项目

```bash
bash scripts/run-task.sh TASK-20250227-001 "Python 计算器" "创建一个命令行计算器"
```

#### 示例 2: 创建电商网站

```bash
bash scripts/run-task.sh TASK-20250228-002 "React 电商网站" "完整的电商网站前端"
```

#### 示例 3: 创建数据分析脚本

```bash
bash scripts/run-task.sh TASK-20250301-001 "销售数据分析" "Python 数据分析脚本"
```

### 在任何目录执行

```bash
# 在首页目录
~$ bash /home/admin/Ziwei/scripts/run-task.sh

# 在临时目录
/tmp$ bash /home/admin/Ziwei/scripts/run-task.sh

# 在任何位置都可以！脚本会自动定位到 Ziwei 目录
```

---

## 🔄 自动执行流程

```
运行命令
  ↓
[步骤 1] 创建项目（GitHub + Gitee）
  ↓
[步骤 2] 等待仓库准备
  ↓
[步骤 3] 克隆项目到本地
  ↓
[步骤 4] 创建任务文件
  ↓
[步骤 5] 提交并推送到双平台
  ↓
[步骤 6] 启动紫微智控处理流程
  ↓
自动执行：
  ├─ T-01 首席架构师 → 任务分解
  ├─ T-02 代码特种兵 → 代码生成
  ├─ T-03 代码审计员 → 代码审计
  ├─ 通信官 → 交付邮件
  └─ 自动归档 → 双平台
```

---

## 📊 每步详细说明

### 步骤 1: 创建项目

- 调用 GitHub API 创建私有仓库
- 调用 Gitee API 创建私有仓库
- 生成本地项目目录

### 步骤 2: 等待准备

- 等待 GitHub/Gitee 初始化
- 确保仓库可访问

### 步骤 3: 克隆项目

- 从 GitHub 克隆到本地
- 配置 Git 用户信息
- 设置远程仓库

### 步骤 4: 创建任务文件

- 生成标准任务文档
- 包含任务 ID、描述、验收标准
- 同步到 inbox 目录

### 步骤 5: 提交推送

- 添加所有文件到 Git
- 提交到本地仓库
- 推送到 GitHub
- 推送到 Gitee

### 步骤 6: 启动处理

- 更新系统状态
- 触发立即同步
- 更新心跳文件
- 紫微智控开始处理

---

## 🎯 完整示例

### 运行命令

```bash
cd /home/admin/Ziwei
bash scripts/run-task.sh TASK-20250227-001 "Python 计算器" "创建一个命令行计算器，支持加减乘除"
```

### 输出示例

```
╔════════════════════════════════════════════════════════╗
║          紫微智控 - 一键启动任务                       ║
╚════════════════════════════════════════════════════════╝

任务信息:
  ID: TASK-20250227-001
  名称：Python 计算器
  描述：创建一个命令行计算器，支持加减乘除
  仓库：task-20250227-001

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
[步骤 1/6] 创建项目（GitHub + Gitee）
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

  ✓ GitHub 仓库创建成功
  ✓ Gitee 仓库创建成功

✓ 步骤 1 完成：项目已创建

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
[步骤 2/6] 等待仓库准备就绪
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

  等待 GitHub/Gitee 初始化仓库...
  ✓ 仓库已就绪

✓ 步骤 2 完成：项目已就绪

...（后续步骤自动执行）

╔════════════════════════════════════════════════════════╗
║              ✅ 任务启动完成！                         ║
╚════════════════════════════════════════════════════════╝
```

---

## 📁 创建后得到什么

### 1. GitHub 仓库

```
https://github.com/ziwei-control/task-20250227-001
```
- ✅ 私有仓库
- ✅ 已初始化
- ✅ 包含任务文件

### 2. Gitee 仓库

```
https://gitee.com/pandac0/task-20250227-001
```
- ✅ 私有仓库
- ✅ 已初始化
- ✅ 包含任务文件

### 3. 本地项目目录

```
/home/admin/Ziwei/projects/TASK-20250227-001/
├── README.md          # 项目说明
├── TASK.md            # 任务文档
├── docs/              # 文档目录
├── src/               # 源代码
├── tests/             # 测试
└── output/            # 输出
```

### 4. 系统状态更新

```
/home/admin/Ziwei/data/system_status.md
```
- 当前任务状态
- 执行进度
- 统计数据

### 5. 启动报告

```
/home/admin/Ziwei/data/logs/task_start_20250227_123456.md
```
- 任务信息
- 仓库地址
- 执行步骤
- 下一步说明

---

## 🔍 查看进度

### 查看系统状态

```bash
cat /home/admin/Ziwei/data/system_status.md
```

### 查看巡查日志

```bash
tail -f /home/admin/Ziwei/data/logs/auto_sync_*.log
```

### 查看项目目录

```bash
ls -la /home/admin/Ziwei/projects/TASK-20250227-001/
```

### 查看 Git 状态

```bash
cd /home/admin/Ziwei/projects/TASK-20250227-001
git status
```

---

## 📊 自动处理流程

任务启动后，紫微智控自动执行：

```
T-01 首席架构师
  ↓ 任务分解
  ↓
T-02 代码特种兵
  ↓ 代码生成
  ↓
T-03 代码审计员
  ↓ 四维审查（最多 20 次）
  ↓
通信官
  ↓ 发送交付邮件
  ↓
自动归档
  ↓ 8 小时后推送双平台
```

---

## ⚠️ 注意事项

### 1. 任务 ID 格式

```
TASK-YYYYMMDD-序号
```

示例：
- `TASK-20250227-001`
- `TASK-20250228-002`
- `TASK-20250301-001`

### 2. 命名规范

- 任务名称：简洁明了
- 任务描述：详细说明需求
- 仓库名：自动转换为小写

### 3. Token 权限

确保已配置：
- `GITHUB_TOKEN` - GitHub API 权限
- `GITEE_TOKEN` - Gitee API 权限（可选）

### 4. SSH Key

确保已添加：
- GitHub SSH 公钥
- Gitee SSH 公钥

---

## 🔧 故障排查

### 问题 1: 项目创建失败

**检查**:
```bash
# 验证 Token
curl -H "Authorization: token YOUR_TOKEN" https://api.github.com/user
```

**解决**:
- 检查 Token 是否有效
- 检查网络连接

### 问题 2: 推送失败

**检查**:
```bash
# 测试 SSH 连接
ssh -T git@github.com
ssh -T git@gitee.com
```

**解决**:
- 添加 SSH 公钥到 GitHub/Gitee
- 检查 SSH 配置

### 问题 3: 任务未自动处理

**检查**:
```bash
# 查看巡查日志
tail -f /home/admin/Ziwei/data/logs/auto_sync_*.log

# 查看 Cron 状态
systemctl status crond
```

**解决**:
- 确保 Cron 服务运行
- 检查任务文件位置

---

## 📋 快速参考

```bash
# 启动新任务
bash scripts/run-task.sh TASK-XXX "名称" "描述"

# 查看系统状态
cat data/system_status.md

# 查看巡查日志
tail -f data/logs/auto_sync_*.log

# 查看项目
ls -la projects/TASK-XXX/

# 查看启动报告
ls -lt data/logs/task_start_*.md | head -1 | xargs cat
```

---

## 🔗 相关文档

- [[项目自动创建指南]] - 单独创建项目
- [[双平台同步说明]] - 自动同步功能
- [[自动同步功能说明]] - 巡查和定时同步
- [[工作流程图]] - 完整工作流程

---

**一个命令，自动完成所有步骤，紫微智控按部就班处理任务！** 🚀
