# ç´«å¾®æ™ºæ§ Â· å®¹é”™åŒæ­¥æœºåˆ¶

> å³ä½¿ä¸€ä¸ªå¹³å°å¤±è´¥ä¹Ÿä¸é˜»å¡æµç¨‹

---

## ğŸ¯ æ ¸å¿ƒç­–ç•¥

**åŸåˆ™**: ä¸å› ä¸€ä¸ªå¹³å°å¤±è´¥è€Œé˜»å¡æ•´ä¸ªæµç¨‹

```
åŒæ­¥ä»»åŠ¡
    â†“
å°è¯•æ¨é€åˆ° GitHub â†’ å¤±è´¥ï¼Ÿâ†’ è®°å½•å¤±è´¥ â†’ ç»§ç»­æ‰§è¡Œ âœ…
    â†“
å°è¯•æ¨é€åˆ° Gitee  â†’ å¤±è´¥ï¼Ÿâ†’ è®°å½•å¤±è´¥ â†’ ç»§ç»­æ‰§è¡Œ âœ…
    â†“
ç”ŸæˆæŠ¥å‘Š â†’ æµç¨‹ç»§ç»­ âœ…
    â†“
å®šæ—¶è‡ªåŠ¨é‡è¯•å¤±è´¥çš„å¹³å°
```

---

## ğŸ“Š åŒæ­¥çŠ¶æ€

| çŠ¶æ€ | è¯´æ˜ | å¤„ç† |
|------|------|------|
| **å®Œå…¨æˆåŠŸ** | GitHub âœ… + Gitee âœ… | æ­£å¸¸ç»§ç»­ |
| **éƒ¨åˆ†æˆåŠŸ** | GitHub âœ… + Gitee âŒ | ç»§ç»­æ‰§è¡Œï¼Œå®šæ—¶é‡è¯• Gitee |
| **éƒ¨åˆ†æˆåŠŸ** | GitHub âŒ + Gitee âœ… | ç»§ç»­æ‰§è¡Œï¼Œå®šæ—¶é‡è¯• GitHub |
| **å…¨éƒ¨å¤±è´¥** | GitHub âŒ + Gitee âŒ | è®°å½•å¤±è´¥ï¼Œå®šæ—¶é‡è¯• |

**é‡ç‚¹**: ä»»ä½•çŠ¶æ€éƒ½**ä¸ä¼šé˜»å¡æµç¨‹**ï¼

---

## ğŸ”„ è‡ªåŠ¨é‡è¯•æœºåˆ¶

### é‡è¯•æ—¶é—´è¡¨

| é‡è¯•ç±»å‹ | é¢‘ç‡ | è¯´æ˜ |
|---------|------|------|
| **å®šæ—¶å·¡æŸ¥** | æ¯ 30 åˆ†é’Ÿ | å‘ç°æ›´æ”¹è‡ªåŠ¨åŒæ­¥ |
| **å¤±è´¥é‡è¯•** | æ¯ 10 åˆ†é’Ÿ | æ£€æŸ¥å¤±è´¥è®°å½•å¹¶é‡è¯• |
| **å¼ºåˆ¶åŒæ­¥** | æ¯æ—¥ 23:40 | æ— è®ºçŠ¶æ€å¦‚ä½•éƒ½åŒæ­¥ |

### é‡è¯•æµç¨‹

```
å¤±è´¥è®°å½•
    â†“
æ¯ 10 åˆ†é’Ÿæ£€æŸ¥
    â†“
å‘ç°å¤±è´¥è®°å½•
    â†“
è‡ªåŠ¨é‡è¯•
    â†“
æˆåŠŸï¼Ÿâ†’ æ¸…é™¤å¤±è´¥è®°å½• âœ…
å¤±è´¥ï¼Ÿâ†’ ä¿ç•™è®°å½•ï¼Œä¸‹æ¬¡é‡è¯•
```

---

## ğŸ“ å¤±è´¥è®°å½•

### è®°å½•ä½ç½®

```
/home/admin/Ziwei/data/logs/sync_failures.log
```

### è®°å½•æ ¼å¼

```
2025-02-27T16:30:00+08:00 GITHUB_PUSH_FAILED
2025-02-27T16:30:05+08:00 GITEE_PUSH_FAILED
```

### æŸ¥çœ‹å¤±è´¥è®°å½•

```bash
cat /home/admin/Ziwei/data/logs/sync_failures.log
```

### æ‰‹åŠ¨é‡è¯•

```bash
bash /home/admin/Ziwei/scripts/retry-failed-sync.sh
```

---

## ğŸ”§ é…ç½®è¯´æ˜

### Cron å®šæ—¶ä»»åŠ¡

```bash
# æ¯ 30 åˆ†é’Ÿå·¡æŸ¥ä¸€æ¬¡ï¼ˆå‘ç°æ›´æ”¹è‡ªåŠ¨åŒæ­¥ï¼‰
*/30 * * * * python3 auto-sync-watchdog.py

# æ¯ 10 åˆ†é’Ÿé‡è¯•å¤±è´¥çš„åŒæ­¥
*/10 * * * * bash retry-failed-sync.sh

# æ¯æ—¥ 23:40 å¼ºåˆ¶åŒæ­¥
40 23 * * * bash sync-to-both.sh
```

### è¶…æ—¶è®¾ç½®

- **æ¨é€è¶…æ—¶**: 30 ç§’
- **é˜²æ­¢**: ç½‘ç»œé—®é¢˜å¯¼è‡´é•¿æ—¶é—´é˜»å¡

---

## ğŸ“Š åŒæ­¥æŠ¥å‘Š

### æŠ¥å‘Šä½ç½®

```
/home/admin/Ziwei/data/logs/sync_report_YYYYMMDD_HHMMSS.md
```

### æŠ¥å‘Šå†…å®¹

```markdown
# ç´«å¾®æ™ºæ§åŒæ­¥æŠ¥å‘Š

**æ—¶é—´**: 2025-02-27 16:30:00

## åŒæ­¥çŠ¶æ€

**æ•´ä½“çŠ¶æ€**: éƒ¨åˆ†æˆåŠŸï¼ˆå·²ç»§ç»­æ‰§è¡Œï¼‰

## å¹³å°çŠ¶æ€

| å¹³å° | çŠ¶æ€ | è¯´æ˜ |
|------|------|------|
| GitHub | âœ… æˆåŠŸ | å·²æ¨é€ |
| Gitee | âš ï¸ å¤±è´¥ï¼ˆå¾…é‡è¯•ï¼‰ | æ¨é€å¤±è´¥ï¼Œå°†åœ¨ä¸‹æ¬¡å®šæ—¶åŒæ­¥é‡è¯• |

## é‡è¯•æœºåˆ¶

- **å¤±è´¥è®°å½•**: `data/logs/sync_failures.log`
- **ä¸‹æ¬¡é‡è¯•**: æ¯ 30 åˆ†é’Ÿè‡ªåŠ¨å·¡æŸ¥
- **å¼ºåˆ¶é‡è¯•**: æ¯æ—¥ 23:40 å¼ºåˆ¶åŒæ­¥

## ç­–ç•¥è¯´æ˜

âœ… **å³ä½¿ä¸€ä¸ªå¹³å°å¤±è´¥ä¹Ÿä¸é˜»å¡æµç¨‹**
```

---

## ğŸ¯ ä½¿ç”¨åœºæ™¯

### åœºæ™¯ 1: GitHub ä¸´æ—¶æ•…éšœ

```
åŒæ­¥å¼€å§‹
  â†“
GitHub æ¨é€å¤±è´¥ï¼ˆç½‘ç»œé—®é¢˜ï¼‰â†’ è®°å½•å¤±è´¥ â†’ ç»§ç»­ âœ…
  â†“
Gitee æ¨é€æˆåŠŸ â†’ ç»§ç»­æ‰§è¡Œ âœ…
  â†“
10 åˆ†é’Ÿåè‡ªåŠ¨é‡è¯• GitHub
  â†“
GitHub æ¨é€æˆåŠŸ â†’ æ¸…é™¤å¤±è´¥è®°å½• âœ…
```

### åœºæ™¯ 2: Gitee SSH å¯†é’¥è¿‡æœŸ

```
åŒæ­¥å¼€å§‹
  â†“
GitHub æ¨é€æˆåŠŸ â†’ ç»§ç»­ âœ…
  â†“
Gitee æ¨é€å¤±è´¥ï¼ˆSSH é—®é¢˜ï¼‰â†’ è®°å½•å¤±è´¥ â†’ ç»§ç»­ âœ…
  â†“
æµç¨‹ç»§ç»­æ‰§è¡Œï¼Œä¸é˜»å¡ âœ…
  â†“
ç®¡ç†å‘˜æ›´æ–° SSH å¯†é’¥
  â†“
ä¸‹æ¬¡å®šæ—¶åŒæ­¥è‡ªåŠ¨æˆåŠŸ
```

### åœºæ™¯ 3: åŒå¹³å°éƒ½å¤±è´¥

```
åŒæ­¥å¼€å§‹
  â†“
GitHub æ¨é€å¤±è´¥ â†’ è®°å½•å¤±è´¥ â†’ ç»§ç»­ âœ…
  â†“
Gitee æ¨é€å¤±è´¥ â†’ è®°å½•å¤±è´¥ â†’ ç»§ç»­ âœ…
  â†“
æµç¨‹ç»§ç»­æ‰§è¡Œï¼Œä¸é˜»å¡ âœ…
  â†“
10 åˆ†é’Ÿåè‡ªåŠ¨é‡è¯•
  â†“
è‡³å°‘ä¸€ä¸ªå¹³å°æˆåŠŸ â†’ ç»§ç»­æ‰§è¡Œ âœ…
```

---

## ğŸ” ç›‘æ§å’Œç®¡ç†

### æŸ¥çœ‹åŒæ­¥çŠ¶æ€

```bash
# æŸ¥çœ‹æœ€æ–°åŒæ­¥æŠ¥å‘Š
ls -lt data/logs/sync_report_*.md | head -1 | xargs cat

# æŸ¥çœ‹å¤±è´¥è®°å½•
cat data/logs/sync_failures.log

# æŸ¥çœ‹ Cron æ—¥å¿—
tail -f data/logs/cron_watchdog.log
tail -f data/logs/cron_retry.log
tail -f data/logs/cron_daily_sync.log
```

### æ‰‹åŠ¨è§¦å‘åŒæ­¥

```bash
# ç«‹å³åŒæ­¥ï¼ˆå®¹é”™æ¨¡å¼ï¼‰
bash scripts/sync-to-both.sh

# é‡è¯•å¤±è´¥åŒæ­¥
bash scripts/retry-failed-sync.sh
```

### æ¸…ç†å¤±è´¥è®°å½•

```bash
# æ‰‹åŠ¨æ¸…ç©ºå¤±è´¥æ—¥å¿—
> data/logs/sync_failures.log
```

---

## âš™ï¸ é…ç½®æ£€æŸ¥æ¸…å•

- [ ] Cron æœåŠ¡è¿è¡Œä¸­
- [ ] æ¯ 30 åˆ†é’Ÿå·¡æŸ¥å·²é…ç½®
- [ ] æ¯ 10 åˆ†é’Ÿé‡è¯•å·²é…ç½®
- [ ] æ¯æ—¥ 23:40 å¼ºåˆ¶åŒæ­¥å·²é…ç½®
- [ ] GitHub è®¤è¯å·²é…ç½®
- [ ] Gitee è®¤è¯å·²é…ç½®
- [ ] å¤±è´¥æ—¥å¿—ç›®å½•å­˜åœ¨
- [ ] åŒæ­¥æŠ¥å‘Šç›®å½•å­˜åœ¨

---

## ğŸ“‹ æ•…éšœæ’æŸ¥

### é—®é¢˜ 1: æŒç»­å¤±è´¥

**æ£€æŸ¥**:
```bash
# æŸ¥çœ‹å¤±è´¥è®°å½•
cat data/logs/sync_failures.log

# æµ‹è¯•è¿æ¥
ssh -T git@github.com
ssh -T git@gitee.com
```

**è§£å†³**:
- æ£€æŸ¥ SSH å¯†é’¥
- æ£€æŸ¥ Token æ˜¯å¦è¿‡æœŸ
- æ£€æŸ¥ç½‘ç»œè¿æ¥

### é—®é¢˜ 2: é‡è¯•ä¸æ‰§è¡Œ

**æ£€æŸ¥**:
```bash
# æŸ¥çœ‹ Cron çŠ¶æ€
systemctl status crond

# æŸ¥çœ‹ Cron æ—¥å¿—
tail data/logs/cron_retry.log
```

**è§£å†³**:
- é‡å¯ Cron æœåŠ¡
- æ£€æŸ¥ Cron é…ç½®

### é—®é¢˜ 3: å¤±è´¥è®°å½•ä¸æ¸…é™¤

**æ£€æŸ¥**:
```bash
# æŸ¥çœ‹å¤±è´¥è®°å½•
cat data/logs/sync_failures.log

# æ‰‹åŠ¨åŒæ­¥æµ‹è¯•
bash scripts/sync-to-both.sh
```

**è§£å†³**:
- æ‰‹åŠ¨åŒæ­¥æˆåŠŸåè‡ªåŠ¨æ¸…é™¤
- æˆ–æ‰‹åŠ¨æ¸…ç©ºï¼š`> data/logs/sync_failures.log`

---

## ğŸ¯ æœ€ä½³å®è·µ

### 1. å®šæœŸæ£€æŸ¥åŒæ­¥çŠ¶æ€

```bash
# æ¯å¤©æŸ¥çœ‹ä¸€æ¬¡
ls -lt data/logs/sync_report_*.md | head -1 | xargs cat
```

### 2. ç›‘æ§å¤±è´¥è®°å½•

```bash
# æ¯å‘¨æ£€æŸ¥å¤±è´¥è®°å½•
wc -l data/logs/sync_failures.log
```

### 3. ç¡®ä¿ SSH å¯†é’¥æœ‰æ•ˆ

```bash
# æ¯æœˆæµ‹è¯•ä¸€æ¬¡
ssh -T git@github.com
ssh -T git@gitee.com
```

### 4. ä¿æŒ Token æ–°é²œ

```bash
# æ¯ 90 å¤©æ›´æ–°ä¸€æ¬¡ Token
# GitHub: https://github.com/settings/tokens
# Gitee: https://gitee.com/profile/personal_access_tokens
```

---

## ğŸ”— ç›¸å…³æ–‡æ¡£

- [[è‡ªåŠ¨åŒæ­¥åŠŸèƒ½è¯´æ˜]] - å·¡æŸ¥å’Œå®šæ—¶åŒæ­¥
- [[åŒå¹³å°åŒæ­¥è¯´æ˜]] - åŒæ­¥åŠŸèƒ½è¯¦è§£
- [[é¡¹ç›®è‡ªåŠ¨åˆ›å»ºæŒ‡å—]] - é¡¹ç›®åˆ›å»º
- [[ä¸€é”®å¯åŠ¨ä»»åŠ¡æŒ‡å—]] - ä»»åŠ¡å¯åŠ¨æµç¨‹

---

**å®¹é”™åŒæ­¥æœºåˆ¶ç¡®ä¿ï¼šå³ä½¿ä¸€ä¸ªå¹³å°å¤±è´¥ï¼Œæµç¨‹ä¹Ÿç»§ç»­æ‰§è¡Œï¼** ğŸš€
