# log-trim - ç´«å¾®æ™ºæ§æ—¥å¿—ä¿®å‰ªå·¥å…·

**ç‰ˆæœ¬**: 1.0.0  
**æ›´æ–°æ—¥æœŸ**: 2026-02-28  
**çŠ¶æ€**: âœ… ç”Ÿäº§å°±ç»ª

---

## ğŸ¯ é¡¹ç›®ç›®æ ‡

24 å°æ—¶ä¸é—´æ–­ç›‘æ§æ—¥å¿—æ–‡ä»¶å¤§å°ï¼Œè¶…è¿‡é˜ˆå€¼ï¼ˆ995MBï¼‰è‡ªåŠ¨ä¿®å‰ªï¼Œé˜²æ­¢æ—¥å¿—è¿‡å¤§å¯¼è‡´ä¸»æœºå¡æ­»ã€‚

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å®‰è£…

```bash
# è¿›å…¥è„šæœ¬ç›®å½•
cd /home/admin/Ziwei/scripts

# è¿è¡Œå®‰è£…è„šæœ¬
bash install-log-trim.sh
```

### éªŒè¯å®‰è£…

```bash
# æŸ¥çœ‹çŠ¶æ€
log-trim status

# æ£€æŸ¥æ—¥å¿—
log-trim check
```

---

## ğŸ“‹ åŠŸèƒ½ç‰¹æ€§

### âœ… æ ¸å¿ƒåŠŸèƒ½

| åŠŸèƒ½ | è¯´æ˜ |
|------|------|
| **è‡ªåŠ¨ç›‘æ§** | 24 å°æ—¶ä¸é—´æ–­ç›‘æ§æ—¥å¿—å¤§å° |
| **é˜ˆå€¼ä¿®å‰ª** | è¾¾åˆ° 995MB è‡ªåŠ¨ä¿®å‰ª |
| **å¤‡ä»½ä¿æŠ¤** | ä¿®å‰ªå‰è‡ªåŠ¨å¤‡ä»½ï¼ˆä¿ç•™ 5 ä¸ªï¼‰ |
| **æ™ºèƒ½æ¸…ç†** | è‡ªåŠ¨æ¸…ç†æ—§å¤‡ä»½ |
| **ç³»ç»ŸæœåŠ¡** | systemd å®ˆæŠ¤è¿›ç¨‹ï¼Œå¼€æœºè‡ªå¯ |
| **è¯¦ç»†æ—¥å¿—** | è®°å½•æ‰€æœ‰ä¿®å‰ªæ“ä½œ |

### ğŸ“Š ç›‘æ§æŒ‡æ ‡

- **é˜ˆå€¼**: 995MBï¼ˆå¯é…ç½®ï¼‰
- **æ£€æŸ¥é—´éš”**: 60 ç§’ï¼ˆå¯é…ç½®ï¼‰
- **å¤‡ä»½æ•°é‡**: 5 ä¸ªï¼ˆå¯é…ç½®ï¼‰
- **ä¿ç•™è¡Œæ•°**: æ™ºèƒ½è®¡ç®—ï¼ˆè‡³å°‘ 1 ä¸‡è¡Œï¼‰

---

## ğŸ› ï¸ ä½¿ç”¨æ–¹æ³•

### å‘½ä»¤

```bash
# æŸ¥çœ‹çŠ¶æ€
log-trim status

# æ£€æŸ¥å¹¶ä¿®å‰ªï¼ˆä¸€æ¬¡æ€§ï¼‰
log-trim check

# æŒç»­ç›‘æ§æ¨¡å¼ï¼ˆ24 å°æ—¶è¿è¡Œï¼‰
log-trim watch --interval 60

# ç«‹å³ä¿®å‰ªï¼ˆä¸ç®¡å¤§å°ï¼‰
log-trim trim

# æ˜¾ç¤ºå¸®åŠ©
log-trim help
```

### æœåŠ¡ç®¡ç†

```bash
# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
systemctl status log-trim

# åœæ­¢æœåŠ¡
systemctl stop log-trim

# å¯åŠ¨æœåŠ¡
systemctl start log-trim

# é‡å¯æœåŠ¡
systemctl restart log-trim

# ç¦ç”¨å¼€æœºè‡ªå¯
systemctl disable log-trim
```

### æ—¥å¿—æŸ¥çœ‹

```bash
# å®æ—¶æŸ¥çœ‹æœåŠ¡æ—¥å¿—
journalctl -u log-trim -f

# æŸ¥çœ‹ä¿®å‰ªå†å²
cat /home/admin/Ziwei/data/logs/log_trim.log

# æŸ¥çœ‹æœ€è¿‘ 100 è¡Œ
tail -100 /home/admin/Ziwei/data/logs/log_trim.log
```

---

## ğŸ“ æ–‡ä»¶ç»“æ„

```
log-trim/
â”œâ”€â”€ log-trim.py              # ä¸»ç¨‹åº
â”œâ”€â”€ install-log-trim.sh      # å®‰è£…è„šæœ¬
â”œâ”€â”€ log-trim.service         # systemd æœåŠ¡é…ç½®
â”œâ”€â”€ README.md                # æœ¬æ–‡æ¡£
â””â”€â”€ scripts/
    â””â”€â”€ log-trim             # å®‰è£…åçš„ç³»ç»Ÿå‘½ä»¤
```

### å®‰è£…åä½ç½®

| æ–‡ä»¶ | è·¯å¾„ |
|------|------|
| **ä¸»ç¨‹åº** | `/home/admin/Ziwei/scripts/log-trim.py` |
| **ç³»ç»Ÿå‘½ä»¤** | `/usr/local/bin/log-trim` |
| **æœåŠ¡é…ç½®** | `/etc/systemd/system/log-trim.service` |
| **ä¿®å‰ªæ—¥å¿—** | `/home/admin/Ziwei/data/logs/log_trim.log` |
| **ç›‘æ§æ—¥å¿—** | `/home/admin/Ziwei/data/logs/self_learn.log` |

---

## âš™ï¸ é…ç½®é€‰é¡¹

### ç¯å¢ƒå˜é‡

| å˜é‡ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|--------|------|
| `MAX_SIZE_MB` | 995 | æœ€å¤§æ–‡ä»¶å¤§å°ï¼ˆMBï¼‰ |
| `BACKUP_COUNT` | 5 | ä¿ç•™å¤‡ä»½æ•°é‡ |
| `CHECK_INTERVAL` | 60 | æ£€æŸ¥é—´éš”ï¼ˆç§’ï¼‰ |

### ä¿®æ”¹é…ç½®

ç¼–è¾‘ `/home/admin/Ziwei/scripts/log-trim.py`ï¼š

```python
# é…ç½®
MAX_SIZE_MB = 995  # ä¿®æ”¹é˜ˆå€¼
BACKUP_COUNT = 5   # ä¿®æ”¹å¤‡ä»½æ•°é‡
```

ç„¶åé‡å¯æœåŠ¡ï¼š

```bash
systemctl restart log-trim
```

---

## ğŸ“Š å·¥ä½œåŸç†

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              log-trim å·¥ä½œæµç¨‹                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å¯åŠ¨æœåŠ¡
    â†“
æ¯ 60 ç§’æ£€æŸ¥æ—¥å¿—å¤§å°
    â†“
å½“å‰å¤§å° >= 995MBï¼Ÿ
    â”œâ”€ å¦ â†’ ç»§ç»­ç›‘æ§
    â””â”€ æ˜¯ â†’ å¼€å§‹ä¿®å‰ª
            â†“
            å¤‡ä»½æ—¥å¿—æ–‡ä»¶
            â†“
            è®¡ç®—ä¿ç•™è¡Œæ•°
            â†“
            åˆ é™¤æ—§å†…å®¹
            â†“
            å†™å…¥ä¿®å‰ªåå†…å®¹
            â†“
            æ¸…ç†æ—§å¤‡ä»½
            â†“
            è®°å½•ä¿®å‰ªæ—¥å¿—
            â†“
            ç»§ç»­ç›‘æ§
```

---

## ğŸ” æ•…éšœæ’æŸ¥

### é—®é¢˜ 1: æœåŠ¡æœªè¿è¡Œ

```bash
# æ£€æŸ¥æœåŠ¡çŠ¶æ€
systemctl status log-trim

# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
journalctl -u log-trim -n 50

# é‡å¯æœåŠ¡
systemctl restart log-trim
```

### é—®é¢˜ 2: æ—¥å¿—æ–‡ä»¶ä¸å­˜åœ¨

```bash
# åˆ›å»ºæ—¥å¿—ç›®å½•
mkdir -p /home/admin/Ziwei/data/logs

# åˆ›å»ºæ—¥å¿—æ–‡ä»¶
touch /home/admin/Ziwei/data/logs/self_learn.log

# é‡å¯æœåŠ¡
systemctl restart log-trim
```

### é—®é¢˜ 3: ä¿®å‰ªå¤±è´¥

```bash
# æ‰‹åŠ¨æµ‹è¯•
log-trim trim

# æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
cat /home/admin/Ziwei/data/logs/log_trim.log | tail -50

# æ£€æŸ¥ç£ç›˜ç©ºé—´
df -h
```

### é—®é¢˜ 4: æƒé™é—®é¢˜

```bash
# æ£€æŸ¥æ–‡ä»¶æƒé™
ls -la /home/admin/Ziwei/scripts/log-trim.py
ls -la /usr/local/bin/log-trim

# ä¿®å¤æƒé™
chmod +x /home/admin/Ziwei/scripts/log-trim.py
chmod +x /usr/local/bin/log-trim
```

---

## ğŸ“ˆ ç›‘æ§å’Œå‘Šè­¦

### æ£€æŸ¥æ—¥å¿—å¤§å°

```bash
# æŸ¥çœ‹å½“å‰å¤§å°
ls -lh /home/admin/Ziwei/data/logs/self_learn.log

# æˆ–ä½¿ç”¨å‘½ä»¤
log-trim status
```

### è®¾ç½®å‘Šè­¦ï¼ˆå¯é€‰ï¼‰

åˆ›å»º cron ä»»åŠ¡ï¼Œå½“æ—¥å¿—è¶…è¿‡ 900MB æ—¶å‘é€å‘Šè­¦ï¼š

```bash
# ç¼–è¾‘ crontab
crontab -e

# æ·»åŠ ä»¥ä¸‹è¡Œï¼ˆæ¯å°æ—¶æ£€æŸ¥ï¼‰
0 * * * * /usr/local/bin/log-trim check >> /var/log/log-trim-cron.log 2>&1
```

---

## ğŸ”„ æ›´æ–°å’Œå‡çº§

### ä» GitHub æ›´æ–°

```bash
# è¿›å…¥ç›®å½•
cd /home/admin/Ziwei/scripts

# æ‹‰å–æœ€æ–°ä»£ç 
git pull origin main

# é‡æ–°å®‰è£…
bash install-log-trim.sh
```

### ä» Gitee æ›´æ–°

```bash
# åˆ‡æ¢åˆ° Gitee è¿œç¨‹
cd /home/admin/Ziwei/scripts
git remote set-url origin https://gitee.com/pandac0/log-trim.git

# æ‹‰å–æœ€æ–°ä»£ç 
git pull

# é‡æ–°å®‰è£…
bash install-log-trim.sh
```

---

## ğŸ“ ç‰ˆæœ¬å†å²

### v1.0.0 (2026-02-28)

- âœ… åˆå§‹ç‰ˆæœ¬å‘å¸ƒ
- âœ… è‡ªåŠ¨ç›‘æ§æ—¥å¿—å¤§å°
- âœ… é˜ˆå€¼ä¿®å‰ªï¼ˆ995MBï¼‰
- âœ… å¤‡ä»½ä¿æŠ¤ï¼ˆ5 ä¸ªï¼‰
- âœ… systemd æœåŠ¡
- âœ… è¯¦ç»†æ—¥å¿—è®°å½•

---

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

- **GitHub**: https://github.com/ziwei-control/log-trim
- **Gitee**: https://gitee.com/pandac0/log-trim

---

## ğŸ“„ è®¸å¯è¯

MIT License

---

## ğŸ“ æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·è”ç³»ï¼š

- **Email**: pandac00@163.com
- **é¡¹ç›®**: ç´«å¾®æ™ºæ§ (Ziwei Control & Intelligence)

---

**log-trim - 24 å°æ—¶å®ˆæŠ¤æ‚¨çš„ç³»ç»Ÿç¨³å®šï¼** ğŸ›¡ï¸
